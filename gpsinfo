<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS åœ°ç†å®šä½è³‡è¨Šé¡¯ç¤º</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­å®šå­—é«”ç‚º Interï¼Œä¸¦ç¢ºä¿æ•´å€‹é é¢çš„èƒŒæ™¯å’Œæ–‡å­—æ¨£å¼ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* æ·ºè—ç°è‰²èƒŒæ™¯ */
            color: #1f2937; /* æ·±ç°è‰²æ–‡å­— */
        }
        /* å¡ç‰‡æ¨£å¼ */
        .info-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            transition: transform 0.3s ease;
        }
        .info-card:hover {
            transform: translateY(-2px);
        }
        /* æŒ‰éˆ•æ¨£å¼ */
        .action-button {
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .action-button:hover {
            box-shadow: 0 6px 8px -2px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }
        /* Modal é®ç½©å±¤ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <!-- åˆå§‹æ¬Šé™è«‹æ±‚ Modal -->
    <div id="permissionModal" class="modal-overlay">
        <div class="bg-white p-8 rounded-2xl max-w-sm mx-4 text-center shadow-2xl">
            <svg class="w-12 h-12 mx-auto text-blue-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            <h2 class="text-2xl font-bold mb-3 text-gray-800">éœ€è¦æ‚¨çš„ä½ç½®è³‡è¨Š</h2>
            <p class="text-gray-600 mb-6">
                æœ¬å·¥å…·å°‡è«‹æ±‚æ‚¨çš„åœ°ç†å®šä½æ¬Šé™ï¼Œä»¥ä¾¿é¡¯ç¤ºæ‰€æœ‰å¯ç”¨çš„ GPS æ•¸æ“šï¼ŒåŒ…æ‹¬ç¶“ç·¯åº¦ã€ç²¾ç¢ºåº¦ã€æµ·æ‹”é«˜åº¦å’Œç§»å‹•é€Ÿåº¦ç­‰ã€‚
            </p>
            <button id="modalStartButton" class="action-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full w-full">
                æˆ‘åŒæ„ä¸¦å•Ÿå‹•åµæ¸¬
            </button>
        </div>
    </div>


    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-blue-600 mb-2">åœ°ç†å®šä½è³‡è¨Šåµæ¸¬å™¨</h1>
            <p class="text-gray-500">ä½¿ç”¨ Geolocation API å–å¾—è£ç½®ä½ç½®çš„å®Œæ•´æ•¸æ“š</p>
        </header>

        <!-- æ§åˆ¶å€å¡Š -->
        <div class="mb-8 p-6 bg-white rounded-xl shadow-lg flex flex-col sm:flex-row justify-between items-center">
            <div id="status-message" class="font-semibold text-lg text-gray-700 mb-4 sm:mb-0">
                ç‹€æ…‹: å°šæœªé–‹å§‹åµæ¸¬
            </div>
            <div class="flex space-x-4">
                <button id="startButton" class="action-button bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full opacity-50 cursor-not-allowed" disabled>
                    é‡æ–°å•Ÿå‹•åµæ¸¬
                </button>
                <button id="stopButton" class="action-button bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-full opacity-50 cursor-not-allowed" disabled>
                    åœæ­¢åµæ¸¬
                </button>
            </div>
        </div>

        <!-- éŒ¯èª¤èˆ‡è¨Šæ¯é¡¯ç¤º -->
        <div id="messageBox" class="hidden mb-6 p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded-lg">
            <!-- éŒ¯èª¤æˆ–æç¤ºè¨Šæ¯å°‡é¡¯ç¤ºåœ¨æ­¤è™• -->
        </div>

        <!-- æ•¸æ“šé¡¯ç¤ºå€å¡Š -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- ç¶“ç·¯åº¦èˆ‡ç²¾ç¢ºåº¦ (æ ¸å¿ƒè³‡è¨Š) -->
            <div class="info-card">
                <h2 class="text-2xl font-bold text-blue-500 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    æ ¸å¿ƒä½ç½®
                </h2>
                <div class="space-y-3 text-lg">
                    <p>ç·¯åº¦ (Latitude): <span id="lat" class="font-mono text-gray-800">N/A</span></p>
                    <p>ç¶“åº¦ (Longitude): <span id="lon" class="font-mono text-gray-800">N/A</span></p>
                    <p>æ°´å¹³ç²¾ç¢ºåº¦ (Accuracy): <span id="accuracy" class="font-mono text-gray-800">N/A</span></p>
                </div>
            </div>

            <!-- æµ·æ‹”é«˜åº¦èˆ‡é€Ÿåº¦ (é‹å‹•è³‡è¨Š) -->
            <div class="info-card">
                <h2 class="text-2xl font-bold text-blue-500 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    é«˜åº¦èˆ‡é€Ÿåº¦
                </h2>
                <div class="space-y-3 text-lg">
                    <p>æµ·æ‹”é«˜åº¦ (Altitude): <span id="altitude" class="font-mono text-gray-800">N/A</span></p>
                    <p>æµ·æ‹”ç²¾ç¢ºåº¦ (Alt. Accuracy): <span id="altitudeAccuracy" class="font-mono text-gray-800">N/A</span></p>
                    <p>é€Ÿåº¦ (Speed, m/s): <span id="speed" class="font-mono text-gray-800">N/A</span></p>
                </div>
            </div>

            <!-- æ–¹å‘èˆ‡æ™‚é–“æˆ³è¨˜ -->
            <div class="info-card">
                <h2 class="text-2xl font-bold text-blue-500 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    æ–¹å‘èˆ‡æ™‚é–“
                </h2>
                <div class="space-y-3 text-lg">
                    <p>èˆªå‘ (Heading): <span id="heading" class="font-mono text-gray-800">N/A</span></p>
                    <p>æ›´æ–°æ™‚é–“ (Timestamp): <span id="timestamp" class="font-mono text-gray-800 text-sm">N/A</span></p>
                    <p>æ™‚é–“å·® (Delay, ms): <span id="delay" class="font-mono text-gray-800">0</span></p>
                </div>
            </div>
            
            <!-- é¡å¤–è¨­å®š -->
            <div class="info-card bg-blue-50">
                <h2 class="text-2xl font-bold text-blue-600 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37h.003z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    å®šä½é¸é …
                </h2 class="text-2xl font-bold text-blue-500 mb-4 flex items-center">
                <div class="space-y-3 text-base">
                    <p>æœ€å¤§ç­‰å¾…æ™‚é–“ (Timeout): <span class="font-semibold text-gray-800">5000 æ¯«ç§’</span></p>
                    <p>æœ€å¤§é½¡ (Maximum Age): <span class="font-semibold text-gray-800">60000 æ¯«ç§’ (1åˆ†é˜)</span></p>
                    <p>é«˜ç²¾ç¢ºåº¦ (High Accuracy): <span class="font-semibold text-green-600">å•Ÿç”¨ (true)</span></p>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        // DOM å…ƒç´ åƒè€ƒ
        const statusMessage = document.getElementById('status-message');
        const messageBox = document.getElementById('messageBox');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const permissionModal = document.getElementById('permissionModal');
        const modalStartButton = document.getElementById('modalStartButton');

        const dataElements = {
            lat: document.getElementById('lat'),
            lon: document.getElementById('lon'),
            accuracy: document.getElementById('accuracy'),
            altitude: document.getElementById('altitude'),
            altitudeAccuracy: document.getElementById('altitudeAccuracy'),
            heading: document.getElementById('heading'),
            speed: document.getElementById('speed'),
            timestamp: document.getElementById('timestamp'),
            delay: document.getElementById('delay')
        };

        let watchId = null; 
        let lastTimestamp = 0; 

        // å®šä½é¸é …
        const geoOptions = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 60000
        };

        // æ ¼å¼åŒ–æ•¸å­—ä¸¦è™•ç† null/NaN
        function formatValue(value, unit = '', fixed = 4) {
            if (value === null || typeof value === 'undefined' || isNaN(value)) {
                return 'N/A';
            }
            if (unit === 'timestamp') {
                return new Date(value).toLocaleString();
            }
            return `${value.toFixed(fixed)} ${unit}`;
        }
        
        // é¡¯ç¤ºè¨Šæ¯åˆ°è¨Šæ¯æ¡†
        function showMessage(type, message) {
            messageBox.classList.remove('hidden', 'bg-red-100', 'bg-yellow-100', 'border-red-400', 'border-yellow-400', 'text-red-700', 'text-yellow-700');
            messageBox.textContent = message;

            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else if (type === 'warning') {
                messageBox.classList.add('bg-yellow-100', 'border-yellow-400', 'text-yellow-700');
            } else {
                 messageBox.classList.add('hidden');
            }
        }

        // æ›´æ–° UI ç‹€æ…‹ç‚ºå·²å•Ÿå‹•
        function setRunningState() {
             // UI ç‹€æ…‹æ›´æ–°
            startButton.disabled = true;
            startButton.classList.add('opacity-50', 'cursor-not-allowed');
            stopButton.disabled = false;
            stopButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // æ›´æ–° UI ç‹€æ…‹ç‚ºå·²åœæ­¢
        function setStoppedState() {
             // UI ç‹€æ…‹æ›´æ–°
            startButton.disabled = false;
            startButton.classList.remove('opacity-50', 'cursor-not-allowed');
            stopButton.disabled = true;
            stopButton.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // æˆåŠŸå–å¾—ä½ç½®æ™‚çš„å›èª¿å‡½æ•¸
        function success(position) {
            // éš±è—åˆå§‹ Modal (å¦‚æœå®ƒé‚„åœ¨)
            permissionModal.classList.add('hidden');
            setRunningState();

            const coords = position.coords;
            const now = Date.now();
            const delay = lastTimestamp ? now - lastTimestamp : 0;
            lastTimestamp = now;

            // æ›´æ–°æ‰€æœ‰æ•¸æ“šæ¬„ä½
            dataElements.lat.textContent = formatValue(coords.latitude, 'Â°', 6);
            dataElements.lon.textContent = formatValue(coords.longitude, 'Â°', 6);
            dataElements.accuracy.textContent = formatValue(coords.accuracy, 'm');
            dataElements.altitude.textContent = formatValue(coords.altitude, 'm', 2);
            dataElements.altitudeAccuracy.textContent = formatValue(coords.altitudeAccuracy, 'm', 2);
            dataElements.heading.textContent = formatValue(coords.heading, 'Â°', 2);
            dataElements.speed.textContent = formatValue(coords.speed, 'm/s', 2);
            dataElements.timestamp.textContent = formatValue(position.timestamp, 'timestamp');
            dataElements.delay.textContent = `${delay} ms`;

            statusMessage.textContent = 'ç‹€æ…‹: åµæ¸¬ä¸­ (æ•¸æ“šå·²æ›´æ–°)';
            messageBox.classList.add('hidden');
        }

        // å–å¾—ä½ç½®å¤±æ•—æ™‚çš„å›èª¿å‡½æ•¸
        function error(err) {
            setStoppedState();
            // éš±è—åˆå§‹ Modal (å¦‚æœå®ƒé‚„åœ¨)
            permissionModal.classList.add('hidden');

            let errorMessage = '';
            
            if (err.code === 1) {
                // Permission Denied (ä½¿ç”¨è€…æ‹’çµ•)
                errorMessage = 'ğŸ“ éŒ¯èª¤ï¼šæ‚¨å·²æ‹’çµ•ä½ç½®æ¬Šé™ã€‚ç”±æ–¼éš±ç§æ”¿ç­–ï¼Œç¶²é ç„¡æ³•å†æ¬¡è‡ªå‹•è«‹æ±‚ã€‚';
                errorMessage += 'è«‹æ‰‹å‹•è‡³ iOS/Safari è¨­å®šä¸­é–‹å•Ÿï¼š';
                errorMessage += 'ã€Œè¨­å®šã€>ã€Œéš±ç§æ¬Šèˆ‡å®‰å…¨æ€§ã€>ã€Œå®šä½æœå‹™ã€> æ‰¾åˆ°æ‚¨çš„ç€è¦½å™¨ (Safari) > å…è¨±å­˜å–ä½ç½®ã€‚';
                statusMessage.textContent = 'ç‹€æ…‹: æ¬Šé™ä¸è¶³ï¼Œå·²åœæ­¢åµæ¸¬';
            } else if (err.code === 2) {
                // Position Unavailable
                errorMessage = 'éŒ¯èª¤ï¼šç„¡æ³•å–å¾—ä½ç½®ã€‚è«‹æª¢æŸ¥æ‚¨çš„ GPS æˆ–ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸ã€‚';
                statusMessage.textContent = 'ç‹€æ…‹: ç„¡æ³•å–å¾—ä½ç½®';
            } else if (err.code === 3) {
                // Timeout
                errorMessage = 'éŒ¯èª¤ï¼šå®šä½è«‹æ±‚è¶…æ™‚ (Timeout)ã€‚å¯èƒ½æ˜¯è¨Šè™Ÿä¸ä½³æˆ–å®¤å…§ç’°å¢ƒå°è‡´ã€‚';
                statusMessage.textContent = 'ç‹€æ…‹: å®šä½è¶…æ™‚';
            } else {
                errorMessage = `ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤: ${err.message}`;
                statusMessage.textContent = 'ç‹€æ…‹: åµæ¸¬å¤±æ•—';
            }
            
            showMessage('error', errorMessage);
        }

        // é–‹å§‹åµæ¸¬åŠŸèƒ½
        function startGeolocation() {
            if (!navigator.geolocation) {
                showMessage('error', 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ Geolocation APIã€‚');
                return;
            }

            if (watchId !== null) {
                // å…ˆåœæ­¢èˆŠçš„ç›£æ¸¬ï¼Œç¢ºä¿æ˜¯é‡æ–°å•Ÿå‹•
                navigator.geolocation.clearWatch(watchId);
            }

            // å•Ÿå‹•æŒçºŒç›£æ¸¬
            watchId = navigator.geolocation.watchPosition(success, error, geoOptions);
            statusMessage.textContent = 'ç‹€æ…‹: æ­£åœ¨ç­‰å¾…ä½ç½®è³‡è¨Š...';
            
            showMessage('warning', 'æç¤ºï¼šåˆæ¬¡å•Ÿå‹•å¯èƒ½éœ€è¦å¹¾ç§’é˜ç­‰å¾… GPS å®šä½ã€‚è«‹ç¢ºä¿å®šä½æœå‹™å·²é–‹å•Ÿã€‚');
        }

        // åœæ­¢åµæ¸¬åŠŸèƒ½
        function stopGeolocation() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
                statusMessage.textContent = 'ç‹€æ…‹: åµæ¸¬å·²åœæ­¢';
                showMessage('warning', 'åµæ¸¬å·²åœæ­¢ã€‚é»æ“Šã€Œé‡æ–°å•Ÿå‹•åµæ¸¬ã€é‡æ–°é–‹å§‹ã€‚');
                setStoppedState();
            }
        }
        
        // é é¢å•Ÿå‹•æµç¨‹ï¼šå…ˆé¡¯ç¤º Modal
        function initialSetup() {
             // æª¢æŸ¥ Geolocation API æ˜¯å¦å¯ç”¨
             if (!navigator.geolocation) {
                permissionModal.classList.add('hidden');
                showMessage('error', 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ Geolocation APIã€‚');
                return;
            }
            // é¡¯ç¤ºåˆå§‹ Modalï¼Œè®“ä½¿ç”¨è€…é»æ“Šå¾Œè§¸ç™¼æ¬Šé™è«‹æ±‚
            permissionModal.classList.remove('hidden');
        }

        // è¨»å†Šäº‹ä»¶ç›£è½å™¨
        modalStartButton.addEventListener('click', () => {
             // éš±è— Modal ä¸¦é–‹å§‹è«‹æ±‚ä½ç½® (é€™æœƒè§¸ç™¼ç€è¦½å™¨çš„æ¬Šé™å½ˆçª—)
            permissionModal.classList.add('hidden');
            startGeolocation();
        });

        startButton.addEventListener('click', startGeolocation);
        stopButton.addEventListener('click', stopGeolocation);
        
        // é é¢è¼‰å…¥æ™‚ï¼ŒåŸ·è¡Œåˆå§‹è¨­å®š
        window.onload = initialSetup;

    </script>
</body>
</html>

